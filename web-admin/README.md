# Ayia Administration

Ayia makes use of a number of Biblical sources:
- YouVersion
- [Berean Standard Bible (interlinear)](versions/interlinear/bsb)
- Strongs : source [openscriptures/strongs](https://github.com/openscriptures/strongs);

These all need to be fetched, extracted, prepared and loaded into the Ayia
database.


Before proceeding, make sure you have initialized the project:
```
npm install
```


## Viewing sources

You can view/identify all available sources via:
```
./etc/version-list

# Lists all available versions/sources presenting:
#   Offical Abbreviation : Local Abbreviation : Full Name
```

You can also view more details about a specific source via:
```
./etc/version-find %Abbreviation%

```

## Loading sources

The loading process involves 4 steps:
1.  Fetch   : download the source data;
    ```
    ./etc/version-fetch %Abbreviation%
    ```
2.  Extract : extract the source data into a processable form;
    ```
    ./etc/version-extract %Abbreviation%
    ```
3.  Prepare : prepare the extracted data for loading;
    ```
    ./etc/version-prepare %Abbreviation%
    ```
4.  Load    : load the prepared data into the database;
    ```
    ./etc/version-load %Abbreviation%
    ```

Each step will automatically invoke the previous if the data required for a
step is not yet available.

Note that the final `Load` process requires direct access to the Ayia database.

From within a container in the Ayia k8s cluster, this should already be setup.

From an external system, this requires additional work:
1.  Request `kubectl` configuration for the Ayia k8s cluster along with
    database access credentials (username, password, database name);
2.  Install `kubectl`;
3.  Setup your `kubectl` configuration to include the Ayia k8s cluster
    credentials;
4.  Update the `CTX` varialbe in [Makefile](Makefile) with the kubectl context
    you established in your local `kubectl` configuration;
5.  Create a proxy from the external system to the Ayia k8s cluster. With a
    functional `kubectl` configuration file and proper updates to `CTX`, you
    should be able to use the [etc/mongo-proxy.sh](etc/mongo-proxy.sh) helper
    script for this;
6.  Update [etc/config.yaml](etc/config.yaml) with the Ayia database access
    credentials;

## Database schemas

Ayia makes use of mongodb with a single database containing multiple
collections:
- `versions` (`version` is a mongo system keyword) : contains a document for
  each Bible version loaded into the database;
  - For each loaded Bible version, there will be a collection named using the
    `abbreviation` from the `versions` document describing this version;
- `concordance` : contains a document for each Concordance (e.g. Strongs)
  loaded into the database;
- `commentary` : contains a document for each Commentary loaded into the
  database;

### Versions

Documents within the `versions` collection have the form the consists of
*at least* :
```javascript
{
  _id         : Id generated by mongo {ObjectId};
  id          : A unique id for this version {Number};
  abbreviation: The unique, upper-cased abbreviation for this version {String};
  title       : The title for this version {String};
  type        : The format type (yvers, interlinear) {String};
  language    : {
    iso_639_1             : ISO 639-1 2-character language code {String};
    iso_639_3             : ISO 639-3 3-character language code {String};
    name                  : The human readable language name {String};
    language_tag          : The primary (ISO 639-1) language tag for this
                            version {String};
    secondarylanguage_tags: A set of secondary language tags (ISO 639-1) for
                            this version {String};
  },

}
```

Each version will have a collection named using the `abbreviation` from the
version list and will have the form:
```javascript
{
  _id   : The BOK.ccc.vvv reference (e.g. GEN.001.001) {String};
  markup: [
    // markup items specific to the `version.type` for this verse
    ...
  ],
  text  : The full text of this verse {String};
}
```

#### Type `yvers` markup
Versions with a type of `yvers` will have markup based on
[USX](https://ubsicap.github.io/usx/index.html) /
[USFM](https://ubsicap.github.io/usfm/).


#### Type `interlinear` markup
Versions with a type of `interlinear` will have markup items in the following
form:
```javascript
{
  language  : The language of this entry (Hebrew | Greek) {String};
  abs_vs    : The absolute verse number {Number};
  wlc       : Text from the Westminster Leningrad Codex {String};
  translit  : Text from the Westminster Leningrad Codex {String};
  tos       : Identifies the type-of-speech {String};
  tos_label : A descriptive label for `tos` {String};
  strongs   : The strongs reference, in relation to `language` {Number};
  heading   : Any section heading related to this entry {String};
  xref      : Any cross reference to other verses
              (e.g. '(John 1:1-5; Hebrews 11:1-3)') {String};
  text      : The text of this entry {String};
  footnotes : Footnote text related to this entry {String};
  bdb       : BDB / Thayers notes {String};
}
```

### Concordance
### Commentary
